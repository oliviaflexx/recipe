{% extends "main/base.html" %}
{% block title %}View Recipes {% endblock %}

{% block content %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'main/css/allrecipes.css' %}">

  {% if user.is_authenticated%}
  <div class="row topper" style="justify-content: space-around;">
    <h1>Explore All Recipes</h1>
  </div>
  <div class="row topper" style="justify-content: space-around;">
    <h3>Filters:</h3>
  </div>
  <form method="post" action="#">
    {% csrf_token %}
  <div class="row">
      <div class="col-12 col-md-4 text-center">
        <h4 class=text-center>Sort by</h4>
          <input type='radio' id='calories' name='orderby' value='calories'>
          <label for='calories'>Calories</label><br>
          <input type='radio' id='time' name='orderby' value='time'>
          <label for='time'>Time</label><br>
      </div>
      <div class="col-12 col-md-4 text-center">
        <h4 class=text-center>Special Diet</h4>
          <input type='checkbox' id='vegeterian' name='restrict' value='vegeterian'>
          <label for='vegeterian'>Vegeterian</label><br>
          <input type='checkbox' id='vegan' name='restrict' value='vegan'>
          <label for='vegan'>Vegan</label><br>
          <input type='checkbox' id='gluten' name='restrict' value='gluten'>
          <label for='gluten'>Gluten Free</label><br>
      </div>
      <div class="col-12 col-md-4 text-center">
        <h4 class=text-center>Meal Type</h4>
          <input type='radio' id='breakfast' name='meal_type' value='breakfast'>
          <label for='breakfast'>Breakfast</label><br>
          <input type='radio' id='lunch' name='meal_type' value='lunch'>
          <label for='lunch'>Lunch/Dinner</label><br>
          <input type='radio' id='dessert' name='meal_type' value='dessert'>
          <label for='dessert'>Dessert</label><br>
      </div>
  </div>
  <div class="row" style="justify-content: space-around;">
    <button type="submit" id='save' name='save' value='save'>Show Preferences</button>
  </div>
</form>
      <form method="POST" action="#">
        {% csrf_token %}
        <div class="row topper">
          {% for user_recipe in posts%}
          <div class="col-lg-6 col-md-12 col-sm-12 text-center">
            <div class="recipe-container text-center">
              <a href= {{user_recipe.recipe.url}} target="_blank"><h4>{{user_recipe.recipe.name}}</h4></a>
              <div class="img-container position-relative start-50 bottom-50">
                <img src={{user_recipe.recipe.image}}> 
                {% if user_recipe.checked == True%}
                  <button type="submit", class = 'add-position-fixed', id = 'c{{user_recipe.recipe.id}}' value='{{user_recipe.recipe.id}}'><i class="bi bi-check-lg recipe-button"></i></button>
                {% else %}
                  <button type="submit", class = 'add-position-fixed', id = 'c{{user_recipe.recipe.id}}' value='{{user_recipe.recipe.id}}'><i class="bi bi-plus-lg recipe-button"></i></button>
                {% endif %}
              </div>
              <p id='cal{{user_recipe.recipe.id}}'></p>
              <p id='time{{user_recipe.recipe.id}}'></p>
              <p id='genres{{user_recipe.recipe.id}}'></p>
            </div>
            <div class="button-container">
              {% if user_recipe.liked == True%}
                <button type='submit', class = 'like', id = 'l{{user_recipe.id}}' value='{{user_recipe.id}}'><i class="bi bi-hand-thumbs-up-fill recipe-button"></i></button>
              {% else %}
                <button type='submit', class = 'like', id = 'l{{user_recipe.id}}' value='{{user_recipe.id}}'><i class="bi bi-hand-thumbs-up-fill recipe-button"></i></button>
              {% endif %}
              {% if user_recipe.disliked == True%}
                <button type="submit", class = 'dislike', id = 'd{{user_recipe.id}}' value='{{user_recipe.id}}'><i class="bi bi-hand-thumbs-down-fill recipe-button"></i></button>
              {% else %}
                <button type="submit", class = 'dislike', id = 'd{{user_recipe.id}}' value='{{user_recipe.id}}'><i class="bi bi-hand-thumbs-down recipe-button"></i></button>
              {% endif %}
            </div>
          </div>
            {% if forloop.counter|divisibleby:4 %}</div><div class="row">{% endif %}
              {% if forloop.last %}</div>{% endif %}
          {% endfor %}
  
        </form>
        {% if posts.paginator.num_pages > 1 %}
            {% if posts.has_previous %}
                <a href="?page={{ posts.previous_page_number }}">previous</a>
            {% endif %}
            <span>Page {{ posts.number }} of {{ posts.paginator.num_pages }}</span>
            {% if posts.has_next %}
                <a href="?page={{ posts.next_page_number }}">next</a>
            {% endif %}
        {% endif %}
    {% else %}
    <a href="/login">Login Here to Access Content</a>
    {% endif%}
    </div>
{% endblock %}
{% block javascript %}
<script>
  $(document).on('click', '.add', function (h) {
      e.preventDefault();
      $.ajax({
      type: 'POST',
      url: '{% url "main:add_recipe" %}',
      data: {
        postid: $(this).val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        action: 'post',
        checked: $(this).text(),
      },
      success: function (json) {
          document.getElementById(json['id']).textContent = json['result']
      },
      error: function (xhr, errmsg, err) {
  
      }
      });
  })
  </script>
  <script>
    $(document).on('click', '.like', function (t) {
      t.preventDefault();
        $.ajax({
        type: 'POST',
        url: '{% url "main:like" %}',
        data: {
          postid: $(this).val(),
          csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
          action: 'post',
        },
        success: function (json) {
          var recipeliked = document.getElementById('l' + json['id']);
          if (json['result'] == 'liked') {
            recipeliked.innerHTML = '<i class="bi bi-hand-thumbs-up-fill"></i>'
            var recipedis = document.getElementById('d' + json['id']);
            recipedis.innerHTML = '<i class="bi bi-hand-thumbs-down"></i>'
          }
          else {
            recipeliked.innerHTML = '<i class="bi bi-hand-thumbs-up"></i>'
          }
        },
        error: function (xhr, errmsg, err) {
    
        }
        });
    })
</script>
<script>
  $(document).on('click', '.dislike', function (h) {
      h.preventDefault();
      $.ajax({
      type: 'POST',
      url: '{% url "main:dislike" %}',
      data: {
        postid: $(this).val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        action: 'post',
      },
      success: function (json) {
        var recipedis = document.getElementById('d' + json['id']);
          if (json['result'] == 'disliked') {
            recipedis.innerHTML = '<i class="bi bi-hand-thumbs-down-fill"></i>';
            var recipeliked = document.getElementById('l' + json['id']);
            recipeliked.innerHTML = '<i class="bi bi-hand-thumbs-up"></i>'
          }
          else if (json['result'] == 'undisliked') {
            recipedis.innerHTML = '<i class="bi bi-hand-thumbs-down"></i>';
          }
      },
      error: function (xhr, errmsg, err) {
  
      }
      });
  })
</script>
<script>
$(document).on('click', '.showmore', function (b) {
  b.preventDefault();
  $.ajax({
  type: 'POST',
  url: '{% url "main:showmore" %}',
  data: {
  postid: $(this).val(),
  csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
  action: 'post',
  shown: $(this).text(),
  },
  success: function (json) {
      document.getElementById('s' + json['id']).textContent = json['result']
      document.getElementById('time' + json['id']).textContent = json['time']
      document.getElementById('cal' + json['id']).textContent = json['calories']
      document.getElementById('genres' + json['id']).textContent = json['genres']
  },
  error: function (xhr, errmsg, err) {

  }
  });
}) 
</script>
{% endblock %}
